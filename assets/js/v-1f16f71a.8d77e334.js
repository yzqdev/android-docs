"use strict";(self.webpackChunkandroid_docs=self.webpackChunkandroid_docs||[]).push([[257],{8649:(n,s,a)=>{a.r(s),a.d(s,{data:()=>t});const t=JSON.parse('{"key":"v-1f16f71a","path":"/flutter/flutter-update.html","title":"flutter安卓更新","lang":"zh-CN","frontmatter":{},"headers":[{"level":3,"title":"应用程序升级流程","slug":"应用程序升级流程","link":"#应用程序升级流程","children":[]},{"level":3,"title":"2.  Android 升级 App 涉及的 API 库","slug":"_2-android-升级-app-涉及的-api-库","link":"#_2-android-升级-app-涉及的-api-库","children":[]},{"level":3,"title":"3. 获取版本信息","slug":"_3-获取版本信息","link":"#_3-获取版本信息","children":[]},{"level":3,"title":"4. 获取文件存储路径","slug":"_4-获取文件存储路径","link":"#_4-获取文件存储路径","children":[]},{"level":3,"title":"5. 文件下载","slug":"_5-文件下载","link":"#_5-文件下载","children":[]},{"level":3,"title":"6.  打开文件","slug":"_6-打开文件","link":"#_6-打开文件","children":[]},{"level":3,"title":"7. 替换版本","slug":"_7-替换版本","link":"#_7-替换版本","children":[]}],"git":{"createdTime":1659917471000,"updatedTime":1673982064000,"contributors":[{"name":"yzqdev","email":"yzqdev@outlook.com","commits":2}]},"readingTime":{"minutes":3.96,"words":1189},"filePathRelative":"flutter/flutter-update.md","localizedDate":"2022年8月8日","excerpt":""}')},5214:(n,s,a)=>{a.r(s),a.d(s,{default:()=>A});var t=a(6252);const e=(0,t._)("h1",{id:"flutter安卓更新",tabindex:"-1"},[(0,t._)("a",{class:"header-anchor",href:"#flutter安卓更新","aria-hidden":"true"},"#"),(0,t.Uk)(" flutter安卓更新")],-1),p=(0,t._)("h3",{id:"应用程序升级流程",tabindex:"-1"},[(0,t._)("a",{class:"header-anchor",href:"#应用程序升级流程","aria-hidden":"true"},"#"),(0,t.Uk)(" 应用程序升级流程")],-1),o=(0,t._)("p",null,"由于在 IOS 中没法直接下载安装，如果版本不一致则直接跳转到IOS应用对应的应用市场就可以了，所以本文仅介绍Android App的升级流程。",-1),l=(0,t._)("p",null,[(0,t._)("strong",null,"Android App升级流程：")],-1),i=(0,t._)("li",null,[(0,t._)("p",null,"获取本地版本号；")],-1),r={href:"https://cloud.tencent.com/product/cvm?from=10680",target:"_blank",rel:"noopener noreferrer"},c=(0,t._)("li",null,[(0,t._)("p",null,"如果本地版本和服务器版本不一致则提示升级，弹窗提示用户是否更新；")],-1),u=(0,t._)("li",null,[(0,t._)("p",null,"用户确定升级，调用文件传输方法下载apk文件；")],-1),d=(0,t._)("li",null,[(0,t._)("p",null,"监听下载进度；")],-1),k=(0,t._)("li",null,[(0,t._)("p",null,"下载完成打开apk进行安装。")],-1),v=(0,t.uE)('<h3 id="_2-android-升级-app-涉及的-api-库" tabindex="-1"><a class="header-anchor" href="#_2-android-升级-app-涉及的-api-库" aria-hidden="true">#</a> 2. Android 升级 App 涉及的 API 库</h3><table><thead><tr><th>名称</th><th>作用</th><th>地址</th></tr></thead><tbody><tr><td>package_info</td><td>获取版本信息</td><td>地址</td></tr><tr><td>path_provider</td><td>获取文件存储位置</td><td>地址</td></tr><tr><td>flutter_downloader</td><td>文件下载</td><td>地址</td></tr><tr><td>open_file</td><td>打开文件</td><td>地址</td></tr></tbody></table><h3 id="_3-获取版本信息" tabindex="-1"><a class="header-anchor" href="#_3-获取版本信息" aria-hidden="true">#</a> 3. 获取版本信息</h3>',3),m={href:"https://pub.flutter-io.cn/packages/package_info",target:"_blank",rel:"noopener noreferrer"},g=(0,t.uE)('<ol><li>安装插件</li></ol><div class="language-dart line-numbers-mode" data-ext="dart"><pre class="language-dart"><code>dependencies<span class="token punctuation">:</span>\n  package_info<span class="token punctuation">:</span> <span class="token operator">^</span><span class="token number">0.4</span><span class="token number">.3</span><span class="token operator">+</span><span class="token number">4</span>\n</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div></div></div><p>在pubspec.yaml中配置保存后，在VS Code环境中会自动下载依赖包。</p><p>如果无法正常下载，执行 flutter pub get 。</p><ol start="2"><li>引入并使用</li></ol><div class="language-dart line-numbers-mode" data-ext="dart"><pre class="language-dart"><code><span class="token comment">// 引入获取版本信息包</span>\n<span class="token keyword">import</span> <span class="token string-literal"><span class="token string">&#39;package:package_info/package_info.dart&#39;</span></span><span class="token punctuation">;</span>\n\n<span class="token class-name">PackageInfo</span> packageInfo <span class="token operator">=</span> <span class="token keyword">await</span> <span class="token class-name">PackageInfo</span><span class="token punctuation">.</span><span class="token function">fromPlatform</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n<span class="token class-name">String</span> appName <span class="token operator">=</span> packageInfo<span class="token punctuation">.</span>appName<span class="token punctuation">;</span>\n<span class="token class-name">String</span> packageName <span class="token operator">=</span> packageInfo<span class="token punctuation">.</span>packageName<span class="token punctuation">;</span>\n<span class="token class-name">String</span> version <span class="token operator">=</span> packageInfo<span class="token punctuation">.</span>version<span class="token punctuation">;</span>\n<span class="token class-name">String</span> buildNumber <span class="token operator">=</span> packageInfo<span class="token punctuation">.</span>buildNumber<span class="token punctuation">;</span>\n\n<span class="token comment">// 应用名称</span>\n<span class="token function">print</span><span class="token punctuation">(</span><span class="token string-literal"><span class="token string">&quot;appName:</span><span class="token interpolation"><span class="token punctuation">${</span><span class="token expression">appName</span><span class="token punctuation">}</span></span><span class="token string">&quot;</span></span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n<span class="token comment">// 包名称</span>\n<span class="token function">print</span><span class="token punctuation">(</span><span class="token string-literal"><span class="token string">&quot;packageName:</span><span class="token interpolation"><span class="token punctuation">${</span><span class="token expression">packageName</span><span class="token punctuation">}</span></span><span class="token string">&quot;</span></span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n<span class="token comment">// 版本号</span>\n<span class="token function">print</span><span class="token punctuation">(</span><span class="token string-literal"><span class="token string">&quot;version:</span><span class="token interpolation"><span class="token punctuation">${</span><span class="token expression">version</span><span class="token punctuation">}</span></span><span class="token string">&quot;</span></span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n<span class="token comment">// 构建编号</span>\n<span class="token function">print</span><span class="token punctuation">(</span><span class="token string-literal"><span class="token string">&quot;buildNumber:</span><span class="token interpolation"><span class="token punctuation">${</span><span class="token expression">buildNumber</span><span class="token punctuation">}</span></span><span class="token string">&quot;</span></span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div>',6),b={id:"_4-获取文件存储路径",tabindex:"-1"},h=(0,t._)("a",{class:"header-anchor",href:"#_4-获取文件存储路径","aria-hidden":"true"},"#",-1),f={href:"https://cloud.tencent.com/product/cfs?from=10680",target:"_blank",rel:"noopener noreferrer"},_={href:"https://pub.flutter-io.cn/packages/path_provider",target:"_blank",rel:"noopener noreferrer"},q=(0,t.uE)('<ol><li>安装插件</li></ol><div class="language-dart line-numbers-mode" data-ext="dart"><pre class="language-dart"><code>dependencies<span class="token punctuation">:</span>\n  path_provider<span class="token punctuation">:</span> <span class="token operator">^</span><span class="token number">1.6</span><span class="token number">.27</span>\n</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div></div></div><p>在pubspec.yaml中配置保存后，在VS Code环境中会自动下载依赖包。</p><p>如果无法正常下载，执行 flutter pub get 。</p><ol start="2"><li>引入并使用</li></ol><div class="language-dart line-numbers-mode" data-ext="dart"><pre class="language-dart"><code><span class="token comment">// 引入获取文件存储路径的包</span>\n<span class="token keyword">import</span> <span class="token string-literal"><span class="token string">&#39;package:path_provider/path_provider.dart&#39;</span></span><span class="token punctuation">;</span>\n\n<span class="token class-name">Directory</span> tempDir <span class="token operator">=</span> <span class="token keyword">await</span> <span class="token function">getTemporaryDirectory</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n<span class="token class-name">String</span> tempPath <span class="token operator">=</span> tempDir<span class="token punctuation">.</span>path<span class="token punctuation">;</span>\n\n<span class="token class-name">Directory</span> appDocDir <span class="token operator">=</span> <span class="token keyword">await</span> <span class="token function">getApplicationDocumentsDirectory</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n<span class="token class-name">String</span> appDocPath <span class="token operator">=</span> appDocDir<span class="token punctuation">.</span>path<span class="token punctuation">;</span>\n\n<span class="token keyword">var</span> directory <span class="token operator">=</span> <span class="token keyword">await</span> <span class="token function">getExternalStorageDirectory</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n\n<span class="token class-name">String</span> storageDirectory <span class="token operator">=</span> directory<span class="token punctuation">.</span>path<span class="token punctuation">;</span>\n<span class="token comment">// 获取临时目录</span>\n<span class="token function">print</span><span class="token punctuation">(</span><span class="token string-literal"><span class="token string">&quot;tempPath:</span><span class="token interpolation"><span class="token punctuation">${</span><span class="token expression">tempPath</span><span class="token punctuation">}</span></span><span class="token string">&quot;</span></span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n<span class="token comment">// 获取应用的安装目录</span>\n<span class="token function">print</span><span class="token punctuation">(</span><span class="token string-literal"><span class="token string">&quot;appDocDir:</span><span class="token interpolation"><span class="token punctuation">${</span><span class="token expression">appDocPath</span><span class="token punctuation">}</span></span><span class="token string">&quot;</span></span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n<span class="token comment">// 获取存储卡的路径</span>\n<span class="token function">print</span><span class="token punctuation">(</span><span class="token string-literal"><span class="token string">&quot;StorageDirectory:</span><span class="token interpolation"><span class="token punctuation">${</span><span class="token expression">storageDirectory</span><span class="token punctuation">}</span></span><span class="token string">&quot;</span></span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="_5-文件下载" tabindex="-1"><a class="header-anchor" href="#_5-文件下载" aria-hidden="true">#</a> 5. 文件下载</h3>',7),w={href:"https://pub.flutter-io.cn/packages/flutter_downloader",target:"_blank",rel:"noopener noreferrer"},y=(0,t.uE)('<ol><li>安装插件</li></ol><div class="language-dart line-numbers-mode" data-ext="dart"><pre class="language-dart"><code>dependencies<span class="token punctuation">:</span>\n  flutter_downloader<span class="token punctuation">:</span> <span class="token operator">^</span><span class="token number">1.5</span><span class="token number">.2</span>\n</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div></div></div><p>在pubspec.yaml中配置保存后，在VS Code环境中会自动下载依赖包。</p><p>如果无法正常下载，执行 flutter pub get 。</p><ol start="2"><li>配置权限</li></ol><p><img src="https://ask.qcloudimg.com/http-save/yehe-7992912/upp00rg5gr.png?imageView2/2/w/1620" alt="img"></p><p>代码如下：</p><div class="language-dart line-numbers-mode" data-ext="dart"><pre class="language-dart"><code><span class="token operator">&lt;</span><span class="token operator">!</span><span class="token operator">--</span> 配置下载与安装相关的权限 <span class="token operator">--</span><span class="token operator">&gt;</span>\n<span class="token operator">&lt;</span>uses<span class="token operator">-</span>permission android<span class="token punctuation">:</span>name<span class="token operator">=</span><span class="token string-literal"><span class="token string">&quot;android.permission.INTERNET&quot;</span></span><span class="token operator">/</span><span class="token operator">&gt;</span>\n<span class="token operator">&lt;</span>uses<span class="token operator">-</span>permission android<span class="token punctuation">:</span>name<span class="token operator">=</span><span class="token string-literal"><span class="token string">&quot;android.permission.WRITE_EXTERNAL_STORAGE&quot;</span></span> <span class="token operator">/</span><span class="token operator">&gt;</span>\n<span class="token operator">&lt;</span>uses<span class="token operator">-</span>permission android<span class="token punctuation">:</span>name<span class="token operator">=</span><span class="token string-literal"><span class="token string">&quot;android.permission.READ_EXTERNAL_STORAGE&quot;</span></span> <span class="token operator">/</span><span class="token operator">&gt;</span>\n<span class="token operator">&lt;</span>uses<span class="token operator">-</span>permission android<span class="token punctuation">:</span>name<span class="token operator">=</span><span class="token string-literal"><span class="token string">&quot;android.permission.REQUEST_INSTALL_PACKAGES&quot;</span></span> <span class="token operator">/</span><span class="token operator">&gt;</span>\n</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>其它配置：</p><p><img src="https://ask.qcloudimg.com/http-save/yehe-7992912/t5rxesp89j.png?imageView2/2/w/1620" alt="img"></p><p>代码如下：</p><div class="language-dart line-numbers-mode" data-ext="dart"><pre class="language-dart"><code><span class="token operator">&lt;</span><span class="token operator">!</span><span class="token operator">--</span> 处理在<span class="token class-name">Android</span>上打开下载文件的通知上的点击操作<span class="token operator">--</span><span class="token operator">&gt;</span>\n<span class="token operator">&lt;</span>provider\n    android<span class="token punctuation">:</span>name<span class="token operator">=</span><span class="token string-literal"><span class="token string">&quot;vn.hunghd.flutterdownloader.DownloadedFileProvider&quot;</span></span>\n    android<span class="token punctuation">:</span>authorities<span class="token operator">=</span><span class="token string-literal"><span class="token string">&quot;</span><span class="token interpolation"><span class="token punctuation">${</span><span class="token expression">applicationId</span><span class="token punctuation">}</span></span><span class="token string">.flutter_downloader.provider&quot;</span></span>\n    android<span class="token punctuation">:</span>exported<span class="token operator">=</span><span class="token string-literal"><span class="token string">&quot;false&quot;</span></span>\n    android<span class="token punctuation">:</span>grantUriPermissions<span class="token operator">=</span><span class="token string-literal"><span class="token string">&quot;true&quot;</span></span><span class="token operator">&gt;</span>\n    <span class="token operator">&lt;</span>meta<span class="token operator">-</span>data\n        android<span class="token punctuation">:</span>name<span class="token operator">=</span><span class="token string-literal"><span class="token string">&quot;android.support.FILE_PROVIDER_PATHS&quot;</span></span>\n        android<span class="token punctuation">:</span>resource<span class="token operator">=</span><span class="token string-literal"><span class="token string">&quot;@xml/provider_paths&quot;</span></span><span class="token operator">/</span><span class="token operator">&gt;</span>\n<span class="token operator">&lt;</span><span class="token operator">/</span>provider<span class="token operator">&gt;</span>\n<span class="token operator">&lt;</span><span class="token operator">!</span><span class="token operator">--</span> 配置最大并发任务数<span class="token punctuation">:</span>插件依赖于<span class="token class-name">WorkManager</span>库 <span class="token operator">--</span><span class="token operator">&gt;</span>\n<span class="token operator">&lt;</span>provider\n    android<span class="token punctuation">:</span>name<span class="token operator">=</span><span class="token string-literal"><span class="token string">&quot;androidx.work.impl.WorkManagerInitializer&quot;</span></span>\n    android<span class="token punctuation">:</span>authorities<span class="token operator">=</span><span class="token string-literal"><span class="token string">&quot;</span><span class="token interpolation"><span class="token punctuation">${</span><span class="token expression">applicationId</span><span class="token punctuation">}</span></span><span class="token string">.workmanager-init&quot;</span></span>\n    tools<span class="token punctuation">:</span>node<span class="token operator">=</span><span class="token string-literal"><span class="token string">&quot;remove&quot;</span></span> <span class="token operator">/</span><span class="token operator">&gt;</span>\n<span class="token operator">&lt;</span>provider\n    android<span class="token punctuation">:</span>name<span class="token operator">=</span><span class="token string-literal"><span class="token string">&quot;vn.hunghd.flutterdownloader.FlutterDownloaderInitializer&quot;</span></span>\n    android<span class="token punctuation">:</span>authorities<span class="token operator">=</span><span class="token string-literal"><span class="token string">&quot;</span><span class="token interpolation"><span class="token punctuation">${</span><span class="token expression">applicationId</span><span class="token punctuation">}</span></span><span class="token string">.flutter-downloader-init&quot;</span></span>\n    android<span class="token punctuation">:</span>exported<span class="token operator">=</span><span class="token string-literal"><span class="token string">&quot;false&quot;</span></span><span class="token operator">&gt;</span>\n    <span class="token operator">&lt;</span><span class="token operator">!</span><span class="token operator">--</span> 设定数字以配置最大并发任务数 <span class="token operator">--</span><span class="token operator">&gt;</span>\n    <span class="token operator">&lt;</span>meta<span class="token operator">-</span>data\n        android<span class="token punctuation">:</span>name<span class="token operator">=</span><span class="token string-literal"><span class="token string">&quot;vn.hunghd.flutterdownloader.MAX_CONCURRENT_TASKS&quot;</span></span>\n        android<span class="token punctuation">:</span>value<span class="token operator">=</span><span class="token string-literal"><span class="token string">&quot;5&quot;</span></span> <span class="token operator">/</span><span class="token operator">&gt;</span>\n<span class="token operator">&lt;</span><span class="token operator">/</span>provider<span class="token operator">&gt;</span>\n</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><ol start="3"><li>引入并使用</li></ol><div class="language-dart line-numbers-mode" data-ext="dart"><pre class="language-dart"><code><span class="token comment">// 引入获取文件路径的包（提前安装）</span>\n<span class="token keyword">import</span> <span class="token string-literal"><span class="token string">&#39;package:path_provider/path_provider.dart&#39;</span></span><span class="token punctuation">;</span>\n<span class="token comment">// 引入文件下载的包</span>\n<span class="token keyword">import</span> <span class="token string-literal"><span class="token string">&#39;package:flutter_downloader/flutter_downloader.dart&#39;</span></span><span class="token punctuation">;</span>\n\n<span class="token comment">// 获取存储卡的路径</span>\n<span class="token keyword">final</span> directory <span class="token operator">=</span> <span class="token keyword">await</span> <span class="token function">getExternalStorageDirectory</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n<span class="token class-name">String</span> _localPath <span class="token operator">=</span> directory<span class="token punctuation">.</span>path<span class="token punctuation">;</span>\n\n\n<span class="token keyword">await</span> <span class="token class-name">FlutterDownloader</span><span class="token punctuation">.</span><span class="token function">enqueue</span><span class="token punctuation">(</span>\n    <span class="token comment">// 远程的APK地址（注意：安卓9.0以上后要求用https）</span>\n    url<span class="token punctuation">:</span> <span class="token string-literal"><span class="token string">&quot;http://www.ionic.wang/shop.apk&quot;</span></span><span class="token punctuation">,</span>\n    <span class="token comment">// 下载保存的路径</span>\n    savedDir<span class="token punctuation">:</span> _localPath<span class="token punctuation">,</span>\n    <span class="token comment">// 是否在手机顶部显示下载进度（仅限安卓）</span>\n    showNotification<span class="token punctuation">:</span><span class="token boolean">true</span><span class="token punctuation">,</span>   \n    <span class="token comment">// 是否允许下载完成点击打开文件（仅限安卓）      </span>\n    openFileFromNotification<span class="token punctuation">:</span><span class="token boolean">true</span><span class="token punctuation">,</span> \n<span class="token punctuation">)</span><span class="token punctuation">;</span>\n\n<span class="token class-name">FlutterDownloader</span><span class="token punctuation">.</span><span class="token function">registerCallback</span><span class="token punctuation">(</span><span class="token punctuation">(</span>id<span class="token punctuation">,</span> status<span class="token punctuation">,</span> progress<span class="token punctuation">)</span><span class="token punctuation">{</span>\n    <span class="token function">print</span><span class="token punctuation">(</span>status<span class="token punctuation">)</span><span class="token punctuation">;</span>\n    <span class="token function">print</span><span class="token punctuation">(</span>progress<span class="token punctuation">)</span><span class="token punctuation">;</span>\n<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="_6-打开文件" tabindex="-1"><a class="header-anchor" href="#_6-打开文件" aria-hidden="true">#</a> 6. 打开文件</h3>',15),x={href:"https://pub.flutter-io.cn/packages/open_file",target:"_blank",rel:"noopener noreferrer"},D=(0,t.uE)('<ol><li>安装插件</li></ol><div class="language-dart line-numbers-mode" data-ext="dart"><pre class="language-dart"><code>dependencies<span class="token punctuation">:</span>\n  open_file<span class="token punctuation">:</span> <span class="token operator">^</span><span class="token number">3.0</span><span class="token number">.3</span>\n</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div></div></div><p>在pubspec.yaml中配置保存后，在VS Code环境中会自动下载依赖包。</p><p>如果无法正常下载，执行 flutter pub get 。</p><ol start="2"><li>引入并使用</li></ol><div class="language-dart line-numbers-mode" data-ext="dart"><pre class="language-dart"><code><span class="token comment">// 引入打开文件的包</span>\n<span class="token keyword">import</span> <span class="token string-literal"><span class="token string">&#39;package:open_file/open_file.dart&#39;</span></span><span class="token punctuation">;</span>\n<span class="token comment">// 引入获取文件路径的包（提前安装）</span>\n<span class="token keyword">import</span> <span class="token string-literal"><span class="token string">&#39;package:path_provider/path_provider.dart&#39;</span></span><span class="token punctuation">;</span>\n\n<span class="token comment">// 获取存储卡的路径</span>\n<span class="token keyword">final</span> directory <span class="token operator">=</span> <span class="token keyword">await</span> <span class="token function">getExternalStorageDirectory</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n<span class="token class-name">String</span> _localPath <span class="token operator">=</span> directory<span class="token punctuation">.</span>path<span class="token punctuation">;</span>\n\n<span class="token comment">// 打开文件,apk的名称需要与下载时对应</span>\n<span class="token class-name">OpenFile</span><span class="token punctuation">.</span><span class="token function">open</span><span class="token punctuation">(</span><span class="token string-literal"><span class="token string">&quot;</span><span class="token interpolation"><span class="token punctuation">${</span><span class="token expression">_localPath</span><span class="token punctuation">}</span></span><span class="token string">/shop.apk&quot;</span></span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="_7-替换版本" tabindex="-1"><a class="header-anchor" href="#_7-替换版本" aria-hidden="true">#</a> 7. 替换版本</h3><p>安装包下载安装后，默认会生成一个新的版本，并不会覆盖原有的应用程序，为此，需要提前做一些版本号的配置。</p><div class="language-dart line-numbers-mode" data-ext="dart"><pre class="language-dart"><code><span class="token operator">&lt;</span><span class="token operator">!</span><span class="token operator">--</span> android<span class="token operator">/</span>app<span class="token operator">/</span>src<span class="token operator">/</span>min<span class="token operator">/</span><span class="token class-name">AndroidManifest</span><span class="token punctuation">.</span>xml <span class="token operator">--</span><span class="token operator">&gt;</span>\n<span class="token operator">&lt;</span>manifest \n    xmlns<span class="token punctuation">:</span>android<span class="token operator">=</span><span class="token string-literal"><span class="token string">&quot;http://schemas.android.com/apk/res/android&quot;</span></span>\n    package<span class="token operator">=</span><span class="token string-literal"><span class="token string">&quot;com.example.my_app&quot;</span></span> \n    android<span class="token punctuation">:</span>versionCode<span class="token operator">=</span><span class="token string-literal"><span class="token string">&quot;2&quot;</span></span> \n    android<span class="token punctuation">:</span>versionName<span class="token operator">=</span><span class="token string-literal"><span class="token string">&quot;0.0.2&quot;</span></span><span class="token operator">&gt;</span>\n    \n    <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>\n\n<span class="token operator">&lt;</span><span class="token operator">/</span>manifest<span class="token operator">&gt;</span>\n</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>上面的代码在打包时，注意事项如下：</p><ol><li><p>package的值不能变，即包名不能变；</p></li><li><p>android:versionCode的值要增加；</p></li><li><p>android:versionName的值要增加。</p></li></ol>',11),S={href:"https://pub.flutter-io.cn/packages/package_info",target:"_blank",rel:"noopener noreferrer"},E=(0,t.uE)('<div class="language-dart line-numbers-mode" data-ext="dart"><pre class="language-dart"><code># pubspec<span class="token punctuation">.</span>yaml\nversion<span class="token punctuation">:</span> <span class="token number">0.0</span><span class="token number">.2</span><span class="token operator">+</span><span class="token number">2</span>\n</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div></div></div><p>上面的代码中0.0.2对应的是android:versionName的值，+2对应的是android:versionCode的值。</p><p>完成上面这些步骤，就可以开始开始正式打包了。</p>',3),N={},A=(0,a(3744).Z)(N,[["render",function(n,s){const a=(0,t.up)("ExternalLinkIcon");return(0,t.wg)(),(0,t.iD)("div",null,[e,p,o,l,(0,t._)("ol",null,[i,(0,t._)("li",null,[(0,t._)("p",null,[(0,t.Uk)("请求"),(0,t._)("a",r,[(0,t.Uk)("服务器"),(0,t.Wm)(a)]),(0,t.Uk)("获取服务器版本号；")])]),c,u,d,k]),v,(0,t._)("p",null,[(0,t._)("a",m,[(0,t.Uk)("https://pub.flutter-io.cn/packages/package_info"),(0,t.Wm)(a)])]),g,(0,t._)("h3",b,[h,(0,t.Uk)(" 4. 获取"),(0,t._)("a",f,[(0,t.Uk)("文件存储"),(0,t.Wm)(a)]),(0,t.Uk)("路径")]),(0,t._)("p",null,[(0,t._)("a",_,[(0,t.Uk)("https://pub.flutter-io.cn/packages/path_provider"),(0,t.Wm)(a)])]),q,(0,t._)("p",null,[(0,t._)("a",w,[(0,t.Uk)("https://pub.flutter-io.cn/packages/flutter_downloader"),(0,t.Wm)(a)])]),y,(0,t._)("p",null,[(0,t._)("a",x,[(0,t.Uk)("https://pub.flutter-io.cn/packages/open_file"),(0,t.Wm)(a)])]),D,(0,t._)("p",null,[(0,t.Uk)("另外，上面代码中配置的版本号在 "),(0,t._)("a",S,[(0,t.Uk)("package_info"),(0,t.Wm)(a)]),(0,t.Uk)(" 这个插件中是无法获取的，所以还需要在pubspec.yaml配置同样的版本信息，这样才能获取版本信息进行对比。")]),E])}]])},3744:(n,s)=>{s.Z=(n,s)=>{const a=n.__vccOpts||n;for(const[n,t]of s)a[n]=t;return a}}}]);